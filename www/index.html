<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>üèπ TENXI ARCHER ¬∑ LOCAL AUDIO</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, sans-serif;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background: linear-gradient(145deg, #0a0f1a, #1a1f30);
            padding: 8px;
        }

        .game-container {
            background: rgba(10, 15, 25, 0.95);
            backdrop-filter: blur(15px);
            border: 2px solid #daa520;
            border-radius: 40px;
            padding: 15px;
            box-shadow: 0 30px 60px black;
            width: min(1200px, 100%);
        }

        .stats-panel {
            display: flex;
            justify-content: space-between;
            background: rgba(0,0,0,0.8);
            border-radius: 50px;
            padding: 12px 25px;
            margin-bottom: 15px;
            border: 1px solid #daa520;
            flex-wrap: wrap;
            gap: 10px;
        }

        .stat-group {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(218,165,32,0.15);
            padding: 5px 20px;
            border-radius: 40px;
            border: 1px solid #daa520;
            color: white;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: #daa520;
            text-shadow: 0 0 15px gold;
        }

        .reset-btn {
            background: rgba(255,60,60,0.2);
            border: 1px solid #ffaa00;
            border-radius: 40px;
            padding: 8px 25px;
            color: white;
            cursor: pointer;
            font-weight: 600;
        }
        .reset-btn:active { transform: scale(0.95); background: rgba(255,80,80,0.4); }

        .canvas-wrapper {
            background: rgba(0,0,0,0.6);
            border-radius: 40px;
            padding: 10px;
        }

        canvas {
            width: 100%;
            height: auto;
            max-width: 1100px;
            aspect-ratio: 1100 / 600;
            border-radius: 35px;
            background: linear-gradient(145deg, #1e3a4f, #0a1a2a);
            box-shadow: inset 0 0 0 3px #daa52033;
            cursor: crosshair;
            touch-action: none;
            display: block;
        }

        .info-panel {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(0,0,0,0.8);
            border-radius: 50px;
            padding: 12px 20px;
            margin-top: 15px;
            border: 1px solid #daa520;
            color: white;
            flex-wrap: wrap;
            gap: 10px;
        }

        .last-shot-badge {
            background: rgba(218,165,32,0.2);
            padding: 5px 20px;
            border-radius: 30px;
            font-size: 1.6rem;
            font-weight: 700;
            min-width: 80px;
            text-align: center;
            border: 1px solid #daa520;
        }

        .audio-controls {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            align-items: center;
        }

        .audio-btn {
            background: rgba(218,165,32,0.2);
            border: 1px solid #daa520;
            border-radius: 40px;
            padding: 8px 18px;
            color: #daa520;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 600;
            white-space: nowrap;
        }
        .audio-btn:active { background: rgba(218,165,32,0.4); }
        
        .audio-status {
            background: rgba(0,0,0,0.5);
            padding: 6px 15px;
            border-radius: 30px;
            font-size: 0.85rem;
            color: #ffd700;
            border: 1px solid #daa520;
            max-width: 180px;
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
        }

        .copyright {
            font-size: 1.2rem;
            color: #daa520;
            border-left: 2px solid #daa520;
            padding-left: 15px;
            font-weight: 600;
        }

        .floating-msg {
            position: fixed;
            top: 25%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(145deg, #daa520, #ffd700);
            padding: 15px 40px;
            border-radius: 60px;
            font-size: 2.5rem;
            font-weight: 800;
            color: black;
            box-shadow: 0 0 80px gold;
            z-index: 9999;
            opacity: 0;
            transition: opacity 0.2s;
            pointer-events: none;
            border: 4px solid white;
            white-space: nowrap;
        }
        .floating-msg.show {
            opacity: 1;
            animation: levelUpAnim 0.4s;
        }
        @keyframes levelUpAnim {
            0% { transform: translate(-50%, -30%) scale(0.3); }
            100% { transform: translate(-50%, -50%) scale(1); }
        }

        @media (max-width: 700px) {
            .stat-value { font-size: 1.5rem; }
            .info-panel { flex-direction: column; align-items: stretch; }
            .copyright { border-left: none; border-top: 2px solid; padding-top: 10px; text-align: center; }
        }
    </style>
</head>
<body>
    <div class="floating-msg" id="levelUpMessage">üéØ LEVEL UP! üéØ</div>
    
    <div class="game-container">
        <!-- HEADER -->
        <div class="stats-panel">
            <div class="stat-group">
                <div class="stat-item"><span>üéöÔ∏è</span> <span class="stat-value" id="levelDisplay">1</span></div>
                <div class="stat-item"><span>üèπ</span> <span class="stat-value" id="scoreDisplay">0</span></div>
                <div class="stat-item"><span>üèÜ</span> <span class="stat-value" id="highScoreDisplay">0</span></div>
            </div>
            <div class="reset-btn" id="resetGameBtn">‚ü≤ RESET</div>
        </div>

        <!-- CANVAS GAME -->
        <div class="canvas-wrapper">
            <canvas id="gameCanvas" width="1100" height="600"></canvas>
        </div>

        <!-- PANEL BAWAH + AUDIO LOKAL (tenxi1.mp3 - tenxi5.mp3) -->
        <div class="info-panel">
            <div style="display: flex; align-items: center; gap: 10px;">
                <span>üéØ LAST:</span>
                <span class="last-shot-badge" id="lastShotDisplay">-</span>
            </div>
            
            <div class="audio-controls">
                <button class="audio-btn" id="playPauseBtn">üîä PLAY</button>
                <button class="audio-btn" id="nextSongBtn">‚è≠Ô∏è NEXT</button>
                <div class="audio-status" id="nowPlaying">üîç Mencari tenxi1.mp3...</div>
            </div>
            
            <div class="copyright">‚ö°AVüî•‚ô™[ùêàùêÜ]‚ô™</div>
        </div>
    </div>

    <script>
        (function() {
            // ==================== FINAL FIX - LOCAL AUDIO ====================
            // ‚úÖ LAGU DARI PENYIMPANAN LOKAL: tenxi1.mp3 - tenxi5.mp3
            // ‚úÖ TARGET MUNCUL
            // ‚úÖ BISA NEMBAK DENGAN GRAVITASI
            // ‚úÖ DESAIN PANAH PREMIUM
            // =================================================================

            const canvas = document.getElementById('gameCanvas');
            const ctx = canvas.getContext('2d');
            
            // UI Elements
            const levelSpan = document.getElementById('levelDisplay');
            const scoreSpan = document.getElementById('scoreDisplay');
            const highScoreSpan = document.getElementById('highScoreDisplay');
            const lastShotSpan = document.getElementById('lastShotDisplay');
            const resetBtn = document.getElementById('resetGameBtn');
            const levelUpMsg = document.getElementById('levelUpMessage');
            const playPauseBtn = document.getElementById('playPauseBtn');
            const nextSongBtn = document.getElementById('nextSongBtn');
            const nowPlaying = document.getElementById('nowPlaying');

            // ========== KONSTANTA GAME ==========
            const CANVAS_W = 1100;
            const CANVAS_H = 600;
            const GRAVITY = 0.18;
            const BOW_X = 950; // Posisi busur tetap di kanan
            let BOW_Y = 300; // Akan berubah sesuai level

            // ========== STATE GAME ==========
            let score = 0;
            let level = 1;
            let highScore = localStorage.getItem('tenxiLocalHigh') ? parseInt(localStorage.getItem('tenxiLocalHigh')) : 0;
            let targets = [];
            let arrow = null;
            let isDragging = false;
            let dragStart = { x: 0, y: 0 };
            let dragEnd = { x: 0, y: 0 };
            let lastShotValue = 0;
            let particles = [];

            // ========== AUDIO SYSTEM - LOCAL FILES ==========
            // Daftar lagu lokal (tenxi1.mp3 sampai tenxi5.mp3)
            const localSongs = [
                { title: "Tenxi - Sepenuh Hati", file: "tenxi1.mp3" },
                { title: "Tenxi - Jangan Jatuh Cinta", file: "tenxi2.mp3" },
                { title: "Tenxi - Sampai Kita Tua", file: "tenxi3.mp3" },
                { title: "Tenxi - Tak Ingin Pisah", file: "tenxi4.mp3" },
                { title: "Tenxi - Viral Indo Mix", file: "tenxi5.mp3" }
            ];
            
            let currentSongIndex = 0;
            let audioPlayer = null;
            let isPlaying = false;
            
            // Inisialisasi audio player
            function initAudio() {
                if (!audioPlayer) {
                    audioPlayer = new Audio();
                    audioPlayer.volume = 0.4;
                    
                    // Auto play next song when current ends
                    audioPlayer.addEventListener('ended', () => {
                        if (isPlaying) {
                            nextSong();
                        }
                    });
                    
                    // Error handling kalau file gak ditemukan
                    audioPlayer.addEventListener('error', (e) => {
                        console.log('Audio error:', e);
                        nowPlaying.innerText = '‚ö†Ô∏è File gak ditemukan!';
                        isPlaying = false;
                        playPauseBtn.innerHTML = 'üîä PLAY';
                    });
                }
            }
            
            // Fungsi untuk memuat dan memutar lagu berdasarkan index
            function loadSong(index) {
                if (!audioPlayer) initAudio();
                
                const song = localSongs[index];
                
                // Cek apakah file ada dengan mencoba memuatnya
                audioPlayer.src = song.file;
                audioPlayer.load();
                
                // Update tampilan
                nowPlaying.innerText = `üìÅ ${song.file} - ${song.title}`;
                
                // Coba putar jika statusnya playing
                if (isPlaying) {
                    audioPlayer.play().catch(err => {
                        console.log('Gagal memutar:', err);
                        nowPlaying.innerText = '‚ùå Gagal memutar file';
                        isPlaying = false;
                        playPauseBtn.innerHTML = 'üîä PLAY';
                    });
                }
            }
            
            // Play/Pause toggle
            playPauseBtn.addEventListener('click', () => {
                initAudio();
                
                if (!audioPlayer.src) {
                    // Pertama kali, muat lagu pertama
                    loadSong(0);
                    isPlaying = true;
                    playPauseBtn.innerHTML = '‚è∏Ô∏è PAUSE';
                } else {
                    if (isPlaying) {
                        audioPlayer.pause();
                        isPlaying = false;
                        playPauseBtn.innerHTML = 'üîä PLAY';
                    } else {
                        audioPlayer.play().catch(err => {
                            console.log('Play gagal:', err);
                            // Coba reload lagu
                            loadSong(currentSongIndex);
                        });
                        isPlaying = true;
                        playPauseBtn.innerHTML = '‚è∏Ô∏è PAUSE';
                    }
                }
            });
            
            // Next song
            function nextSong() {
                currentSongIndex = (currentSongIndex + 1) % localSongs.length;
                loadSong(currentSongIndex);
                
                if (isPlaying) {
                    audioPlayer.play().catch(err => {
                        console.log('Play gagal:', err);
                    });
                }
            }
            
            nextSongBtn.addEventListener('click', nextSong);
            
            // Cek ketersediaan file saat pertama kali
            function checkLocalFiles() {
                initAudio();
                
                // Coba load lagu pertama untuk cek
                const testAudio = new Audio();
                testAudio.src = localSongs[0].file;
                
                testAudio.addEventListener('error', () => {
                    nowPlaying.innerText = '‚ö†Ô∏è tenxi1.mp3 tidak ditemukan!';
                });
                
                testAudio.addEventListener('canplaythrough', () => {
                    nowPlaying.innerText = `‚úÖ ${localSongs[0].file} siap`;
                }, { once: true });
            }
            
            // Panggil pengecekan file
            checkLocalFiles();

            // ========== FUNGSI GAME ==========
            
            // GENERATE TARGET - PASTI MUNCUL
            function generateTargets() {
                const newTargets = [];
                let count, size, speedRange;
                
                if (level <= 3) {
                    count = 1;
                    size = 80;
                    speedRange = [0.5, 1.2];
                } else if (level <= 6) {
                    count = 2;
                    size = 65;
                    speedRange = [1.2, 2.2];
                } else if (level <= 9) {
                    count = 3;
                    size = 50;
                    speedRange = [2.0, 3.0];
                } else {
                    count = 4;
                    size = 40;
                    speedRange = [2.5, 4.0];
                }
                
                for (let i = 0; i < count; i++) {
                    const margin = 100;
                    const x = margin + Math.random() * (CANVAS_W - 2 * margin - 200);
                    const y = margin + Math.random() * (CANVAS_H - 2 * margin);
                    const speedX = (Math.random() * (speedRange[1] - speedRange[0]) + speedRange[0]) * (Math.random() > 0.5 ? 1 : -1);
                    const speedY = (Math.random() * (speedRange[1] - speedRange[0]) + speedRange[0]) * (Math.random() > 0.5 ? 1 : -1);
                    
                    newTargets.push({
                        x, y,
                        vx: speedX,
                        vy: speedY,
                        radius: size / 2
                    });
                }
                
                return newTargets;
            }

            // Update posisi busur (biar variatif tiap level)
            function updateBowPosition() {
                BOW_Y = 200 + (level * 10) % 350;
            }

            // Reset game
            function resetGame() {
                score = 0;
                level = 1;
                targets = generateTargets();
                arrow = null;
                particles = [];
                lastShotValue = 0;
                lastShotSpan.innerText = '-';
                updateBowPosition();
                updateUI();
            }

            // Update UI
            function updateUI() {
                levelSpan.innerText = level;
                scoreSpan.innerText = score;
                if (score > highScore) {
                    highScore = score;
                    localStorage.setItem('tenxiLocalHigh', highScore);
                }
                highScoreSpan.innerText = highScore;
            }

            // Cek level up
            function checkLevelUp() {
                const newLevel = Math.floor(score / 50) + 1;
                if (newLevel > level) {
                    level = newLevel;
                    targets = generateTargets();
                    updateBowPosition();
                    
                    levelUpMsg.classList.add('show');
                    setTimeout(() => levelUpMsg.classList.remove('show'), 800);
                    
                    for (let i = 0; i < 25; i++) {
                        particles.push({
                            x: CANVAS_W/2,
                            y: CANVAS_H/2,
                            vx: (Math.random() - 0.5) * 12,
                            vy: (Math.random() - 0.5) * 12,
                            life: 1,
                            size: 5 + Math.random() * 10,
                            color: `hsl(${Math.random() * 60 + 40}, 100%, 60%)`
                        });
                    }
                }
            }

            // Tambah skor
            function addScore(amount) {
                score += amount;
                lastShotValue = amount;
                lastShotSpan.innerText = (amount > 0 ? '+' : '') + amount;
                if (score < 0) score = 0;
                updateUI();
                checkLevelUp();
            }

            // Update partikel
            function updateParticles() {
                for (let i = particles.length - 1; i >= 0; i--) {
                    const p = particles[i];
                    p.x += p.vx;
                    p.y += p.vy;
                    p.vy += 0.08;
                    p.life -= 0.015;
                    if (p.life <= 0) {
                        particles.splice(i, 1);
                    }
                }
            }

            // Update target (gerak)
            function updateTargets() {
                for (let t of targets) {
                    t.x += t.vx;
                    t.y += t.vy;
                    
                    if (t.x - t.radius < 40) {
                        t.x = t.radius + 40;
                        t.vx *= -1;
                    }
                    if (t.x + t.radius > CANVAS_W - 140) {
                        t.x = CANVAS_W - t.radius - 140;
                        t.vx *= -1;
                    }
                    if (t.y - t.radius < 40) {
                        t.y = t.radius + 40;
                        t.vy *= -1;
                    }
                    if (t.y + t.radius > CANVAS_H - 40) {
                        t.y = CANVAS_H - t.radius - 40;
                        t.vy *= -1;
                    }
                }
            }

            // Cek tabrakan panah dengan target
            function checkArrowCollision() {
                if (!arrow || !arrow.aktif) return false;
                
                for (let i = targets.length - 1; i >= 0; i--) {
                    const t = targets[i];
                    const dx = arrow.x - t.x;
                    const dy = arrow.y - t.y;
                    const dist = Math.sqrt(dx*dx + dy*dy);
                    
                    if (dist < t.radius) {
                        const isBullseye = dist < t.radius * 0.35;
                        const points = isBullseye ? 10 : 5;
                        addScore(points);
                        
                        for (let j = 0; j < (isBullseye ? 20 : 10); j++) {
                            particles.push({
                                x: t.x,
                                y: t.y,
                                vx: (Math.random() - 0.5) * 8,
                                vy: (Math.random() - 0.5) * 8 - 3,
                                life: 1,
                                size: 4 + Math.random() * 8,
                                color: isBullseye ? 'gold' : '#ffaa66'
                            });
                        }
                        
                        targets.splice(i, 1);
                        
                        let newTarget;
                        if (level <= 3) {
                            newTarget = generateTargets()[0];
                        } else {
                            let size, speedRange;
                            if (level <= 6) { size = 65; speedRange = [1.2, 2.2]; }
                            else if (level <= 9) { size = 50; speedRange = [2.0, 3.0]; }
                            else { size = 40; speedRange = [2.5, 4.0]; }
                            
                            newTarget = {
                                x: 100 + Math.random() * (CANVAS_W - 300),
                                y: 80 + Math.random() * (CANVAS_H - 160),
                                vx: (Math.random() * (speedRange[1] - speedRange[0]) + speedRange[0]) * (Math.random() > 0.5 ? 1 : -1),
                                vy: (Math.random() * (speedRange[1] - speedRange[0]) + speedRange[0]) * (Math.random() > 0.5 ? 1 : -1),
                                radius: size / 2
                            };
                        }
                        targets.push(newTarget);
                        
                        arrow.aktif = false;
                        arrow = null;
                        return true;
                    }
                }
                
                if (arrow.x < -70 || arrow.x > CANVAS_W + 70 || arrow.y < -70 || arrow.y > CANVAS_H + 70) {
                    addScore(-5);
                    arrow.aktif = false;
                    arrow = null;
                }
                return false;
            }

            // Update fisika panah
            function updateArrow() {
                if (arrow && arrow.aktif) {
                    arrow.x += arrow.vx;
                    arrow.y += arrow.vy;
                    arrow.vy += GRAVITY;
                    
                    checkArrowCollision();
                }
            }

            // Fungsi menembak panah
            function shootArrow(toX, toY) {
                const dx = toX - BOW_X;
                const dy = toY - BOW_Y;
                const angle = Math.atan2(dy, dx);
                const power = Math.min(20, Math.hypot(dx, dy) * 0.3);
                
                arrow = {
                    x: BOW_X,
                    y: BOW_Y,
                    vx: Math.cos(angle) * power,
                    vy: Math.sin(angle) * power,
                    aktif: true
                };
            }

            // ========== HANDLE DRAG ==========
            function handleStart(e) {
                e.preventDefault();
                if (arrow && arrow.aktif) return;
                
                const rect = canvas.getBoundingClientRect();
                const scaleX = canvas.width / rect.width;
                const scaleY = canvas.height / rect.height;
                
                let clientX, clientY;
                if (e.touches) {
                    clientX = e.touches[0].clientX;
                    clientY = e.touches[0].clientY;
                } else {
                    clientX = e.clientX;
                    clientY = e.clientY;
                }
                
                const canvasX = (clientX - rect.left) * scaleX;
                const canvasY = (clientY - rect.top) * scaleY;
                
                const distToBow = Math.hypot(canvasX - BOW_X, canvasY - BOW_Y);
                if (distToBow < 70) {
                    isDragging = true;
                    dragStart.x = BOW_X;
                    dragStart.y = BOW_Y;
                    dragEnd.x = canvasX;
                    dragEnd.y = canvasY;
                }
            }

            function handleMove(e) {
                if (!isDragging) return;
                e.preventDefault();
                
                const rect = canvas.getBoundingClientRect();
                const scaleX = canvas.width / rect.width;
                const scaleY = canvas.height / rect.height;
                
                let clientX, clientY;
                if (e.touches) {
                    clientX = e.touches[0].clientX;
                    clientY = e.touches[0].clientY;
                } else {
                    clientX = e.clientX;
                    clientY = e.clientY;
                }
                
                const canvasX = (clientX - rect.left) * scaleX;
                const canvasY = (clientY - rect.top) * scaleY;
                
                dragEnd.x = Math.min(CANVAS_W, Math.max(0, canvasX));
                dragEnd.y = Math.min(CANVAS_H, Math.max(0, canvasY));
            }

            function handleEnd(e) {
                if (!isDragging) return;
                e.preventDefault();
                
                if (!(arrow && arrow.aktif)) {
                    shootArrow(dragEnd.x, dragEnd.y);
                }
                
                isDragging = false;
            }

            // ========== GAMBAR SEMUA ==========
            function draw() {
                ctx.clearRect(0, 0, CANVAS_W, CANVAS_H);
                
                // Background
                const bgGrad = ctx.createLinearGradient(0, 0, CANVAS_W, CANVAS_H);
                bgGrad.addColorStop(0, '#1a2f40');
                bgGrad.addColorStop(0.5, '#2d4f6e');
                bgGrad.addColorStop(1, '#1a2f40');
                ctx.fillStyle = bgGrad;
                ctx.fillRect(0, 0, CANVAS_W, CANVAS_H);
                
                // Gambar TARGET
                for (let t of targets) {
                    ctx.beginPath();
                    ctx.arc(t.x, t.y, t.radius, 0, Math.PI * 2);
                    ctx.fillStyle = 'rgba(255,255,255,0.9)';
                    ctx.shadowColor = '#daa520';
                    ctx.shadowBlur = 25;
                    ctx.fill();
                    
                    ctx.beginPath();
                    ctx.arc(t.x, t.y, t.radius * 0.35, 0, Math.PI * 2);
                    const bullGrad = ctx.createRadialGradient(t.x-5, t.y-5, 5, t.x, t.y, t.radius*0.35);
                    bullGrad.addColorStop(0, '#ffd966');
                    bullGrad.addColorStop(1, '#b8860b');
                    ctx.fillStyle = bullGrad;
                    ctx.shadowBlur = 30;
                    ctx.fill();
                }
                
                // Gambar BUSUR PREMIUM
                ctx.shadowBlur = 30;
                ctx.shadowColor = '#daa520';
                
                ctx.beginPath();
                ctx.ellipse(BOW_X, BOW_Y, 45, 60, 0, 0, Math.PI * 2);
                ctx.strokeStyle = '#b8860b';
                ctx.lineWidth = 14;
                ctx.stroke();
                
                ctx.beginPath();
                ctx.ellipse(BOW_X, BOW_Y, 35, 48, 0, 0, Math.PI * 2);
                ctx.strokeStyle = '#daa520';
                ctx.lineWidth = 6;
                ctx.stroke();
                
                ctx.beginPath();
                ctx.moveTo(BOW_X - 30, BOW_Y - 45);
                ctx.lineTo(BOW_X + 30, BOW_Y + 45);
                ctx.strokeStyle = '#f4e542';
                ctx.lineWidth = 5;
                ctx.stroke();
                
                ctx.beginPath();
                ctx.moveTo(BOW_X + 30, BOW_Y - 45);
                ctx.lineTo(BOW_X - 30, BOW_Y + 45);
                ctx.strokeStyle = '#f4e542';
                ctx.lineWidth = 5;
                ctx.stroke();
                
                ctx.beginPath();
                ctx.arc(BOW_X, BOW_Y, 18, 0, Math.PI * 2);
                ctx.fillStyle = '#8b5a2b';
                ctx.shadowBlur = 30;
                ctx.fill();
                
                ctx.beginPath();
                ctx.arc(BOW_X, BOW_Y, 10, 0, Math.PI * 2);
                ctx.fillStyle = '#daa520';
                ctx.shadowBlur = 40;
                ctx.fill();
                
                ctx.fillStyle = '#654321';
                ctx.shadowBlur = 25;
                ctx.fillRect(BOW_X - 10, BOW_Y + 25, 20, 45);
                
                for (let i = 0; i < 3; i++) {
                    ctx.beginPath();
                    ctx.moveTo(BOW_X - 20 + i*15, BOW_Y + 40);
                    ctx.lineTo(BOW_X - 15 + i*15, BOW_Y + 80);
                    ctx.strokeStyle = '#aaa';
                    ctx.lineWidth = 3;
                    ctx.stroke();
                    
                    ctx.beginPath();
                    ctx.moveTo(BOW_X - 15 + i*15, BOW_Y + 80);
                    ctx.lineTo(BOW_X - 12 + i*15, BOW_Y + 85);
                    ctx.lineTo(BOW_X - 18 + i*15, BOW_Y + 85);
                    ctx.closePath();
                    ctx.fillStyle = '#c0c0c0';
                    ctx.fill();
                }
                
                if (arrow && arrow.aktif) {
                    ctx.beginPath();
                    ctx.moveTo(arrow.x, arrow.y);
                    ctx.lineTo(arrow.x - arrow.vx * 4, arrow.y - arrow.vy * 4);
                    ctx.strokeStyle = '#d4af37';
                    ctx.lineWidth = 6;
                    ctx.shadowBlur = 30;
                    ctx.stroke();
                    
                    const angle = Math.atan2(arrow.vy, arrow.vx);
                    const tipX = arrow.x + Math.cos(angle) * 12;
                    const tipY = arrow.y + Math.sin(angle) * 12;
                    
                    ctx.beginPath();
                    ctx.moveTo(tipX, tipY);
                    ctx.lineTo(arrow.x + Math.cos(angle - 2.5) * 8, arrow.y + Math.sin(angle - 2.5) * 8);
                    ctx.lineTo(arrow.x + Math.cos(angle + 2.5) * 8, arrow.y + Math.sin(angle + 2.5) * 8);
                    ctx.closePath();
                    ctx.fillStyle = '#b8860b';
                    ctx.fill();
                    
                    ctx.beginPath();
                    ctx.moveTo(arrow.x - Math.cos(angle) * 15, arrow.y - Math.sin(angle) * 15);
                    ctx.lineTo(arrow.x - Math.cos(angle) * 25 + Math.cos(angle - 1) * 8, arrow.y - Math.sin(angle) * 25 + Math.sin(angle - 1) * 8);
                    ctx.lineTo(arrow.x - Math.cos(angle) * 25 + Math.cos(angle + 1) * 8, arrow.y - Math.sin(angle) * 25 + Math.sin(angle + 1) * 8);
                    ctx.closePath();
                    ctx.fillStyle = '#8b4513';
                    ctx.fill();
                }
                
                if (isDragging) {
                    ctx.beginPath();
                    ctx.moveTo(dragStart.x, dragStart.y);
                    ctx.lineTo(dragEnd.x, dragEnd.y);
                    ctx.strokeStyle = 'rgba(218,165,32,0.7)';
                    ctx.lineWidth = 4;
                    ctx.setLineDash([10, 10]);
                    ctx.stroke();
                    ctx.setLineDash([]);
                    
                    let vx = (dragStart.x - dragEnd.x) * 0.3;
                    let vy = (dragStart.y - dragEnd.y) * 0.3;
                    let px = dragStart.x;
                    let py = dragStart.y;
                    
                    for (let i = 0; i < 20; i++) {
                        px += vx;
                        py += vy;
                        vy += GRAVITY;
                        
                        ctx.beginPath();
                        ctx.arc(px, py, 3, 0, Math.PI * 2);
                        ctx.fillStyle = `rgba(255,215,0,${1 - i * 0.05})`;
                        ctx.fill();
                    }
                }
                
                for (let p of particles) {
                    ctx.globalAlpha = p.life;
                    ctx.beginPath();
                    ctx.arc(p.x, p.y, p.size * p.life, 0, Math.PI * 2);
                    ctx.fillStyle = p.color;
                    ctx.shadowBlur = 20;
                    ctx.fill();
                }
                
                ctx.globalAlpha = 1;
                ctx.shadowBlur = 0;
                ctx.shadowColor = 'transparent';
            }

            // Game loop
            function gameLoop() {
                updateTargets();
                updateArrow();
                updateParticles();
                draw();
                requestAnimationFrame(gameLoop);
            }

            // ========== EVENT LISTENERS ==========
            canvas.addEventListener('mousedown', handleStart);
            canvas.addEventListener('mousemove', handleMove);
            canvas.addEventListener('mouseup', handleEnd);
            canvas.addEventListener('mouseleave', handleEnd);
            
            canvas.addEventListener('touchstart', handleStart, { passive: false });
            canvas.addEventListener('touchmove', handleMove, { passive: false });
            canvas.addEventListener('touchend', handleEnd);
            canvas.addEventListener('touchcancel', handleEnd);
            
            canvas.addEventListener('contextmenu', (e) => e.preventDefault());
            
            resetBtn.addEventListener('click', resetGame);

            // ========== INIT ==========
            highScoreSpan.innerText = highScore;
            resetGame();
            gameLoop();
        })();
    </script>
</body>
</html>